<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora COSMIC Completa</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .content {
            padding: 30px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 3px solid #e9ecef;
            margin-bottom: 30px;
        }
        
        .tab {
            padding: 15px 25px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            border-radius: 10px 10px 0 0;
            margin-right: 5px;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: #3498db;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid #3498db;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 15px;
            align-items: end;
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #e9ecef;
        }
        
        .cosmic-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .cosmic-card:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .cosmic-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        
        .entry { background: #e74c3c; }
        .exit { background: #f39c12; }
        .read { background: #27ae60; }
        .write { background: #9b59b6; }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .result-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
            padding: 25px;
            text-align: center;
        }
        
        .result-card.secondary {
            background: linear-gradient(135deg, #2c3e50, #3498db);
        }
        
        .result-card.accent {
            background: linear-gradient(135deg, #e74c3c, #f39c12);
        }
        
        .result-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .breakdown-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .breakdown-item strong {
            display: block;
            font-size: 1.4rem;
            margin-bottom: 5px;
        }
        
        .btn {
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }
        
        .estimation-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .estimation-table th {
            background: #3498db;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .estimation-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .estimation-table tr:hover {
            background: #f8f9fa;
        }
        
        .tips {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .tips h4 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .risk-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .risk-low { background: #d4edda; color: #155724; }
        .risk-medium { background: #fff3cd; color: #856404; }
        .risk-high { background: #f8d7da; color: #721c24; }
        
        @media (max-width: 768px) {
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                margin-right: 0;
                margin-bottom: 5px;
                border-radius: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Calculadora COSMIC Profesional</h1>
            <p>Sistema Completo de Estimaci√≥n de Costos de Software</p>
        </div>
        
        <div class="content">
            <div class="tabs">
                <button class="tab active" onclick="showTab('project')">üìã Proyecto</button>
                <button class="tab" onclick="showTab('cosmic')">üéØ Medici√≥n COSMIC</button>
                <button class="tab" onclick="showTab('estimation')">üí∞ Estimaci√≥n Costos</button>
                <button class="tab" onclick="showTab('results')">üìä Resultados</button>
            </div>
            
            <!-- TAB 1: INFORMACI√ìN DEL PROYECTO -->
            <div id="project" class="tab-content active">
                <div class="section">
                    <h2>üìã Informaci√≥n General del Proyecto</h2>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>Nombre del Proyecto</label>
                            <input type="text" id="projectName" placeholder="Ej: Sistema de Gesti√≥n Comercial">
                        </div>
                        <div class="form-group">
                            <label>Versi√≥n</label>
                            <input type="text" id="version" placeholder="1.0" value="1.0">
                        </div>
                        <div class="form-group">
                            <label>Cliente/Organizaci√≥n</label>
                            <input type="text" id="client" placeholder="Nombre del cliente">
                        </div>
                        <div class="form-group">
                            <label>Fecha de Estimaci√≥n</label>
                            <input type="date" id="date">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Descripci√≥n del Proyecto</label>
                        <textarea id="description" rows="4" placeholder="Descripci√≥n detallada del proyecto, objetivos y alcance..."></textarea>
                    </div>
                </div>
                
                <div class="section">
                    <h2>‚öôÔ∏è Caracter√≠sticas T√©cnicas</h2>
                    <div class="grid-3">
                        <div class="form-group">
                            <label>Tipo de Aplicaci√≥n</label>
                            <select id="appType">
                                <option value="web">Aplicaci√≥n Web</option>
                                <option value="desktop">Aplicaci√≥n Escritorio</option>
                                <option value="mobile">Aplicaci√≥n M√≥vil</option>
                                <option value="api">API/Servicios Web</option>
                                <option value="embedded">Sistema Embebido</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Complejidad del Proyecto</label>
                            <select id="complexity">
                                <option value="low">Baja - Funcionalidades simples</option>
                                <option value="medium" selected>Media - Funcionalidades est√°ndar</option>
                                <option value="high">Alta - Funcionalidades complejas</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Experiencia del Equipo</label>
                            <select id="teamExperience">
                                <option value="junior">Junior - Menos de 2 a√±os</option>
                                <option value="intermediate" selected>Intermedio - 2-5 a√±os</option>
                                <option value="senior">Senior - M√°s de 5 a√±os</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- TAB 2: MEDICI√ìN COSMIC -->
            <div id="cosmic" class="tab-content">
                <div class="section">
                    <h2>üéØ Gu√≠a de Medici√≥n COSMIC</h2>
                    <div class="grid-2">
                        <div class="cosmic-card">
                            <h3><span class="icon entry">E</span>Entry (Entrada)</h3>
                            <p><strong>¬øQu√© contar?</strong> Datos que ingresan al sistema desde actores externos.</p>
                            <p><strong>Ejemplos:</strong> Formularios de registro, datos de APIs externas, archivos CSV importados, par√°metros de b√∫squeda.</p>
                        </div>
                        
                        <div class="cosmic-card">
                            <h3><span class="icon exit">X</span>Exit (Salida)</h3>
                            <p><strong>¬øQu√© contar?</strong> Datos que salen del sistema hacia actores externos.</p>
                            <p><strong>Ejemplos:</strong> Reportes PDF, emails autom√°ticos, datos exportados, APIs de salida.</p>
                        </div>
                        
                        <div class="cosmic-card">
                            <h3><span class="icon read">R</span>Read (Lectura)</h3>
                            <p><strong>¬øQu√© contar?</strong> Lectura de datos persistentes almacenados.</p>
                            <p><strong>Ejemplos:</strong> Consultar base de datos, leer archivos de configuraci√≥n, validar usuarios.</p>
                        </div>
                        
                        <div class="cosmic-card">
                            <h3><span class="icon write">W</span>Write (Escritura)</h3>
                            <p><strong>¬øQu√© contar?</strong> Modificaci√≥n de datos persistentes.</p>
                            <p><strong>Ejemplos:</strong> Insertar registros, actualizar datos, eliminar informaci√≥n, guardar configuraciones.</p>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2>üìù Registro de Procesos Funcionales</h2>
                    <div id="functional-processes">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Proceso Funcional</label>
                                <input type="text" placeholder="Ej: Gesti√≥n de usuarios">
                            </div>
                            <div class="form-group">
                                <label>Entry</label>
                                <input type="number" value="0" min="0" class="entry-input">
                            </div>
                            <div class="form-group">
                                <label>Exit</label>
                                <input type="number" value="0" min="0" class="exit-input">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="addFunctionalProcess()">‚ûï Agregar Proceso</button>
                </div>
                
                <div class="section">
                    <h2>üî¢ Resumen de Movimientos</h2>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>üì• Total Movimientos Entry</label>
                            <input type="number" id="totalEntries" value="0" min="0" readonly style="background: #f8f9fa;">
                        </div>
                        <div class="form-group">
                            <label>üì§ Total Movimientos Exit</label>
                            <input type="number" id="totalExits" value="0" min="0" readonly style="background: #f8f9fa;">
                        </div>
                        <div class="form-group">
                            <label>üìñ Total Movimientos Read</label>
                            <input type="number" id="totalReads" value="0" min="0">
                        </div>
                        <div class="form-group">
                            <label>‚úçÔ∏è Total Movimientos Write</label>
                            <input type="number" id="totalWrites" value="0" min="0">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- TAB 3: ESTIMACI√ìN DE COSTOS -->
            <div id="estimation" class="tab-content">
                <div class="section">
                    <h2>üí∞ Par√°metros de Estimaci√≥n</h2>
                    <div class="grid-3">
                        <div class="form-group">
                            <label>Productividad (CFP por d√≠a)</label>
                            <input type="number" id="productivity" value="0.5" step="0.1" min="0.1">
                            <small>T√≠pico: Junior 0.3, Intermedio 0.5, Senior 0.8</small>
                        </div>
                        <div class="form-group">
                            <label>Tarifa por Hora (USD)</label>
                            <input type="number" id="hourlyRate" value="25" min="1">
                        </div>
                        <div class="form-group">
                            <label>Horas por D√≠a</label>
                            <input type="number" id="hoursPerDay" value="8" min="1" max="12">
                        </div>
                        <div class="form-group">
                            <label>Factor de Complejidad</label>
                            <select id="complexityFactor">
                                <option value="0.8">Baja (0.8)</option>
                                <option value="1.0" selected>Media (1.0)</option>
                                <option value="1.3">Alta (1.3)</option>
                                <option value="1.6">Muy Alta (1.6)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Factor de Riesgo</label>
                            <select id="riskFactor">
                                <option value="1.0">Bajo (1.0)</option>
                                <option value="1.2" selected>Medio (1.2)</option>
                                <option value="1.5">Alto (1.5)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Overhead (%)</label>
                            <input type="number" id="overhead" value="20" min="0" max="100">
                            <small>Gesti√≥n, testing, documentaci√≥n</small>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2>üë• Composici√≥n del Equipo</h2>
                    <table class="estimation-table">
                        <thead>
                            <tr>
                                <th>Rol</th>
                                <th>Personas</th>
                                <th>% Dedicaci√≥n</th>
                                <th>Tarifa/Hora</th>
                                <th>Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody id="teamComposition">
                            <tr>
                                <td><input type="text" value="Desarrollador Senior" style="border: none; background: transparent;"></td>
                                <td><input type="number" value="1" min="1" style="width: 60px;"></td>
                                <td><input type="number" value="100" min="1" max="100" style="width: 60px;">%</td>
                                <td>$<input type="number" value="35" min="1" style="width: 80px;"></td>
                                <td><button onclick="removeTeamRow(this)" style="background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 5px;">‚ùå</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <button class="btn btn-secondary" onclick="addTeamMember()">‚ûï Agregar Rol</button>
                </div>
            </div>
            
            <!-- TAB 4: RESULTADOS -->
            <div id="results" class="tab-content">
                <div class="results-grid">
                    <div class="result-card">
                        <h3>üéØ Tama√±o COSMIC</h3>
                        <div class="result-value" id="totalCFP">0</div>
                        <p>Puntos de Funci√≥n COSMIC (CFP)</p>
                        <div class="breakdown">
                            <div class="breakdown-item">
                                <strong id="entryCFP">0</strong>
                                <span>Entry</span>
                            </div>
                            <div class="breakdown-item">
                                <strong id="exitCFP">0</strong>
                                <span>Exit</span>
                            </div>
                            <div class="breakdown-item">
                                <strong id="readCFP">0</strong>
                                <span>Read</span>
                            </div>
                            <div class="breakdown-item">
                                <strong id="writeCFP">0</strong>
                                <span>Write</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-card secondary">
                        <h3>‚è±Ô∏è Estimaci√≥n Temporal</h3>
                        <div class="result-value" id="totalDays">0</div>
                        <p>D√≠as de Desarrollo</p>
                        <div style="margin-top: 15px; font-size: 14px;">
                            <p>üóìÔ∏è <strong id="totalWeeks">0</strong> semanas</p>
                            <p>üìÖ <strong id="totalMonths">0</strong> meses</p>
                        </div>
                    </div>
                    
                    <div class="result-card accent">
                        <h3>üíµ Costo Total</h3>
                        <div class="result-value">$<span id="totalCost">0</span></div>
                        <p>D√≥lares Americanos</p>
                        <div style="margin-top: 15px; font-size: 14px;">
                            <p>üí∞ Desarrollo: $<span id="developmentCost">0</span></p>
                            <p>üìä Overhead: $<span id="overheadCost">0</span></p>
                        </div>
                    </div>
                </div>
                
                <div class="section" style="margin-top: 30px;">
                    <h2>üìà An√°lisis de Riesgo</h2>
                    <div id="riskAnalysis" style="padding: 20px; background: white; border-radius: 10px;">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                </div>
                
                <div class="section">
                    <h2>üìã Desglose Detallado</h2>
                    <table class="estimation-table">
                        <thead>
                            <tr>
                                <th>Concepto</th>
                                <th>Cantidad</th>
                                <th>Unidad</th>
                                <th>Tarifa</th>
                                <th>Subtotal</th>
                            </tr>
                        </thead>
                        <tbody id="detailedBreakdown">
                            <!-- Se llenar√° din√°micamente -->
                        </tbody>
                    </table>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="calculateAll()">üßÆ Recalcular Todo</button>
                    <button class="btn btn-secondary" onclick="exportResults()">üíæ Exportar Resultados</button>
                    <button class="btn btn-secondary" onclick="generateReport()">üìÑ Generar Reporte</button>
                </div>
            </div>
            
            <div class="tips">
                <h4>üí° Consejos Profesionales</h4>
                <ul>
                    <li><strong>Documentaci√≥n:</strong> Registra todos los procesos funcionales identificados y las decisiones tomadas</li>
                    <li><strong>Revisi√≥n por Pares:</strong> Valida tus mediciones COSMIC con otros miembros del equipo</li>
                    <li><strong>Factores de Ajuste:</strong> Considera la complejidad t√©cnica, experiencia del equipo y riesgos del proyecto</li>
                    <li><strong>Contingencias:</strong> Incluye un buffer de 10-30% para imprevistos seg√∫n el nivel de incertidumbre</li>
                    <li><strong>Seguimiento:</strong> Compara las estimaciones con los resultados reales para mejorar futuras estimaciones</li>
                </ul>
            </div>
        </div>
    </div>
    
    <script>
        // Establecer fecha actual por defecto
        document.getElementById('date').valueAsDate = new Date();
        
        // Variables globales
        let functionalProcesses = [];
        let teamMembers = [];
        
        // Gesti√≥n de tabs
        function showTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar tab seleccionado
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Calcular autom√°ticamente cuando se vaya a resultados
            if (tabName === 'results') {
                calculateAll();
            }
        }
        
        // Agregar proceso funcional
        function addFunctionalProcess() {
            const container = document.getElementById('functional-processes');
            const newRow = document.createElement('div');
            newRow.className = 'form-row';
            newRow.innerHTML = `
                <div class="form-group">
                    <input type="text" placeholder="Nuevo proceso funcional">
                </div>
                <div class="form-group">
                    <input type="number" value="0" min="0" class="entry-input">
                </div>
                <div class="form-group">
                    <input type="number" value="0" min="0" class="exit-input">
                </div>
                <button onclick="removeFunctionalProcess(this)" style="background: #e74c3c; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer;">‚ùå</button>
            `;
            container.appendChild(newRow);
            
            // Agregar listeners para auto-c√°lculo
            newRow.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('input', updateTotals);
            });
        }
        
        function removeFunctionalProcess(button) {
            button.parentElement.remove();
            updateTotals();
        }
        
        // Actualizar totales autom√°ticamente
        function updateTotals() {
            const entryInputs = document.querySelectorAll('.entry-input');
            const exitInputs = document.querySelectorAll('.exit-input');
            
            let totalEntries = 0;
            let totalExits = 0;
            
            entryInputs.forEach(input => {
                totalEntries += parseInt(input.value) || 0;
            });
            
            exitInputs.forEach(input => {
                totalExits += parseInt(input.value) || 0;
            });
            
            document.getElementById('totalEntries').value = totalEntries;
            document.getElementById('totalExits').value = totalExits;
        }
        
        // Agregar miembro del equipo
        function addTeamMember() {
            const tbody = document.getElementById('teamComposition');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="text" placeholder="Rol" style="border: none; background: transparent;"></td>
                <td><input type="number" value="1" min="1" style="width: 60px;"></td>
                <td><input type="number" value="100" min="1" max="100" style="width: 60px;">%</td>
                <td>$<input type="number" value="25" min="1" style="width: 80px;"></td>
                <td><button onclick="removeTeamRow(this)" style="background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 5px;">‚ùå</button></td>
            `;
            tbody.appendChild(newRow);
        }
        
        function removeTeamRow(button) {
            button.closest('tr').remove();
        }
        
        // C√°lculo principal
        function calculateAll() {
            // Obtener valores COSMIC
            const entries = parseInt(document.getElementById('totalEntries').value) || 0;
            const exits = parseInt(document.getElementById('totalExits').value) || 0;
            const reads = parseInt(document.getElementById('totalReads').value) || 0;
            const writes = parseInt(document.getElementById('totalWrites').value) || 0;
            
            // Calcular CFP
            const entryCFP = entries * 1;
            const exitCFP = exits * 1;
            const readCFP = reads * 1;
            const writeCFP = writes * 1;
            const totalCFP = entryCFP + exitCFP + readCFP + writeCFP;
            
            // Obtener par√°metros de estimaci√≥n
            const productivity = parseFloat(document.getElementById('productivity').value) || 0.5;
            const hourlyRate = parseFloat(document.getElementById('hourlyRate').value) || 25;
            const hoursPerDay = parseFloat(document.getElementById('hoursPerDay').value) || 8;
            const complexityFactor = parseFloat(document.getElementById('complexityFactor').value) || 1.0;
            const riskFactor = parseFloat(document.getElementById('riskFactor').value) || 1.2;
            const overhead = parseFloat(document.getElementById('overhead').value) || 20;
            
            // Calcular esfuerzo base
            const baseDays = totalCFP / productivity;
            const adjustedDays = baseDays * complexityFactor * riskFactor;
            const totalDays = Math.ceil(adjustedDays);
            const totalWeeks = Math.ceil(totalDays / 5);
            const totalMonths = Math.round((totalDays / 22) * 10) / 10;
            
            // Calcular costos base
            const dailyRate = hourlyRate * hoursPerDay;
            const baseCost = totalDays * dailyRate;
            
            // Calcular costo del equipo
            const teamRows = document.querySelectorAll('#teamComposition tr');
            let teamCost = 0;
            
            teamRows.forEach(row => {
                const inputs = row.querySelectorAll('input[type="number"]');
                if (inputs.length >= 3) {
                    const people = parseFloat(inputs[0].value) || 1;
                    const dedication = parseFloat(inputs[1].value) || 100;
                    const rate = parseFloat(inputs[2].value) || 25;
                    const memberDays = totalDays * (dedication / 100);
                    const memberCost = memberDays * people * rate * hoursPerDay;
                    teamCost += memberCost;
                }
            });
            
            // Si no hay equipo definido, usar costo base
            const developmentCost = teamCost > 0 ? teamCost : baseCost;
            const overheadCost = developmentCost * (overhead / 100);
            const totalCost = developmentCost + overheadCost;
            
            // Actualizar UI - Resultados COSMIC
            document.getElementById('totalCFP').textContent = totalCFP;
            document.getElementById('entryCFP').textContent = entryCFP;
            document.getElementById('exitCFP').textContent = exitCFP;
            document.getElementById('readCFP').textContent = readCFP;
            document.getElementById('writeCFP').textContent = writeCFP;
            
            // Actualizar UI - Tiempo
            document.getElementById('totalDays').textContent = totalDays;
            document.getElementById('totalWeeks').textContent = totalWeeks;
            document.getElementById('totalMonths').textContent = totalMonths;
            
            // Actualizar UI - Costos
            document.getElementById('totalCost').textContent = Math.round(totalCost).toLocaleString();
            document.getElementById('developmentCost').textContent = Math.round(developmentCost).toLocaleString();
            document.getElementById('overheadCost').textContent = Math.round(overheadCost).toLocaleString();
            
            // Generar an√°lisis de riesgo
            generateRiskAnalysis(totalCFP, totalDays, totalCost);
            
            // Generar desglose detallado
            generateDetailedBreakdown(totalCFP, totalDays, developmentCost, overheadCost, teamRows);
        }
        
        // An√°lisis de riesgo
        function generateRiskAnalysis(cfp, days, cost) {
            const riskContainer = document.getElementById('riskAnalysis');
            let risks = [];
            
            // An√°lisis por tama√±o
            if (cfp > 500) {
                risks.push({
                    factor: 'Tama√±o del Proyecto',
                    level: 'high',
                    description: `Proyecto muy grande (${cfp} CFP). Requiere gesti√≥n especializada y divisi√≥n en fases.`
                });
            } else if (cfp > 150) {
                risks.push({
                    factor: 'Tama√±o del Proyecto',
                    level: 'medium',
                    description: `Proyecto mediano-grande (${cfp} CFP). Requiere planificaci√≥n cuidadosa.`
                });
            } else {
                risks.push({
                    factor: 'Tama√±o del Proyecto',
                    level: 'low',
                    description: `Proyecto peque√±o-mediano (${cfp} CFP). Riesgo manejable.`
                });
            }
            
            // An√°lisis por duraci√≥n
            if (days > 365) {
                risks.push({
                    factor: 'Duraci√≥n',
                    level: 'high',
                    description: `Proyecto muy largo (${Math.round(days/30)} meses). Alto riesgo de cambios en requisitos.`
                });
            } else if (days > 180) {
                risks.push({
                    factor: 'Duraci√≥n',
                    level: 'medium',
                    description: `Duraci√≥n considerable (${Math.round(days/30)} meses). Riesgo moderado de cambios.`
                });
            } else {
                risks.push({
                    factor: 'Duraci√≥n',
                    level: 'low',
                    description: `Duraci√≥n razonable (${Math.round(days/30)} meses). Riesgo bajo.`
                });
            }
            
            // An√°lisis por costo
            if (cost > 500000) {
                risks.push({
                    factor: 'Inversi√≥n',
                    level: 'high',
                    description: `Inversi√≥n muy alta (${Math.round(cost/1000)}K). Requiere aprobaci√≥n ejecutiva y seguimiento estricto.`
                });
            } else if (cost > 100000) {
                risks.push({
                    factor: 'Inversi√≥n',
                    level: 'medium',
                    description: `Inversi√≥n considerable (${Math.round(cost/1000)}K). Requiere justificaci√≥n s√≥lida de ROI.`
                });
            } else {
                risks.push({
                    factor: 'Inversi√≥n',
                    level: 'low',
                    description: `Inversi√≥n moderada (${Math.round(cost/1000)}K). Riesgo financiero bajo.`
                });
            }
            
            // Generar HTML del an√°lisis
            const riskHTML = risks.map(risk => `
                <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px;">
                    <span class="risk-indicator risk-${risk.level}">${risk.level === 'high' ? 'Alto' : risk.level === 'medium' ? 'Medio' : 'Bajo'}</span>
                    <div>
                        <strong>${risk.factor}:</strong> ${risk.description}
                    </div>
                </div>
            `).join('');
            
            riskContainer.innerHTML = riskHTML;
        }
        
        // Desglose detallado
        function generateDetailedBreakdown(cfp, days, devCost, overheadCost, teamRows) {
            const tbody = document.getElementById('detailedBreakdown');
            const hourlyRate = parseFloat(document.getElementById('hourlyRate').value) || 25;
            const hoursPerDay = parseFloat(document.getElementById('hoursPerDay').value) || 8;
            
            let html = `
                <tr>
                    <td><strong>Medici√≥n COSMIC</strong></td>
                    <td>${cfp}</td>
                    <td>CFP</td>
                    <td>-</td>
                    <td>-</td>
                </tr>
                <tr>
                    <td>D√≠as de Desarrollo</td>
                    <td>${days}</td>
                    <td>D√≠as</td>
                    <td>${hourlyRate * hoursPerDay}</td>
                    <td>${Math.round(devCost).toLocaleString()}</td>
                </tr>
            `;
            
            // Agregar costos por rol si hay equipo definido
            if (teamRows.length > 0) {
                teamRows.forEach((row, index) => {
                    const inputs = row.querySelectorAll('input');
                    if (inputs.length >= 4) {
                        const role = inputs[0].value || `Rol ${index + 1}`;
                        const people = parseFloat(inputs[1].value) || 1;
                        const dedication = parseFloat(inputs[2].value) || 100;
                        const rate = parseFloat(inputs[3].value) || 25;
                        
                        const memberDays = days * (dedication / 100);
                        const memberCost = memberDays * people * rate * hoursPerDay;
                        
                        html += `
                            <tr>
                                <td>&nbsp;&nbsp;‚Ü≥ ${role}</td>
                                <td>${people} √ó ${Math.round(memberDays)}</td>
                                <td>Persona-d√≠as</td>
                                <td>${rate}/hora</td>
                                <td>${Math.round(memberCost).toLocaleString()}</td>
                            </tr>
                        `;
                    }
                });
            }
            
            html += `
                <tr style="background: #f8f9fa;">
                    <td><strong>Subtotal Desarrollo</strong></td>
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                    <td><strong>${Math.round(devCost).toLocaleString()}</strong></td>
                </tr>
                <tr>
                    <td>Overhead (${document.getElementById('overhead').value}%)</td>
                    <td>-</td>
                    <td>Gesti√≥n, testing, docs</td>
                    <td>-</td>
                    <td>${Math.round(overheadCost).toLocaleString()}</td>
                </tr>
                <tr style="background: #e3f2fd; font-weight: bold;">
                    <td><strong>TOTAL PROYECTO</strong></td>
                    <td>-</td>
                    <td>-</td>
                    <td>-</td>
                    <td><strong>${Math.round(devCost + overheadCost).toLocaleString()}</strong></td>
                </tr>
            `;
            
            tbody.innerHTML = html;
        }
        
        // Exportar resultados
        function exportResults() {
            const projectName = document.getElementById('projectName').value || 'Proyecto_Sin_Nombre';
            const version = document.getElementById('version').value || '1.0';
            const date = document.getElementById('date').value || new Date().toISOString().split('T')[0];
            const client = document.getElementById('client').value || 'Cliente';
            
            // Obtener todos los valores calculados
            const cfp = document.getElementById('totalCFP').textContent;
            const days = document.getElementById('totalDays').textContent;
            const cost = document.getElementById('totalCost').textContent.replace(/,/g, '');
            const entries = document.getElementById('totalEntries').value;
            const exits = document.getElementById('totalExits').value;
            const reads = document.getElementById('totalReads').value;
            const writes = document.getElementById('totalWrites').value;
            
            const csvContent = `Estimaci√≥n COSMIC - ${projectName}
Fecha de Estimaci√≥n,${date}
Cliente,${client}
Versi√≥n,${version}

MEDICI√ìN COSMIC
Tipo de Movimiento,Cantidad,CFP
Entry (Entrada),${entries},${entries}
Exit (Salida),${exits},${exits}
Read (Lectura),${reads},${reads}
Write (Escritura),${writes},${writes}
TOTAL CFP,${cfp}

ESTIMACI√ìN TEMPORAL Y COSTOS
Concepto,Valor
D√≠as de Desarrollo,${days}
Semanas,${document.getElementById('totalWeeks').textContent}
Meses,${document.getElementById('totalMonths').textContent}
Costo Total (USD),${cost}
Costo Desarrollo,${document.getElementById('developmentCost').textContent.replace(/,/g, '')}
Costo Overhead,${document.getElementById('overheadCost').textContent.replace(/,/g, '')}

PAR√ÅMETROS UTILIZADOS
Productividad (CFP/d√≠a),${document.getElementById('productivity').value}
Tarifa por Hora (USD),${document.getElementById('hourlyRate').value}
Horas por D√≠a,${document.getElementById('hoursPerDay').value}
Factor Complejidad,${document.getElementById('complexityFactor').value}
Factor Riesgo,${document.getElementById('riskFactor').value}
Overhead (%),${document.getElementById('overhead').value}`;
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `Estimacion_COSMIC_${projectName.replace(/\s+/g, '_')}_${date}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Generar reporte completo
        function generateReport() {
            const projectName = document.getElementById('projectName').value || 'Proyecto Sin Nombre';
            const version = document.getElementById('version').value || '1.0';
            const client = document.getElementById('client').value || 'Cliente';
            const date = document.getElementById('date').value || new Date().toISOString().split('T')[0];
            const description = document.getElementById('description').value || 'Sin descripci√≥n';
            
            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Reporte de Estimaci√≥n COSMIC - ${projectName}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
                        .header { text-align: center; border-bottom: 3px solid #3498db; padding-bottom: 20px; margin-bottom: 30px; }
                        .section { margin-bottom: 30px; }
                        .section h2 { color: #2c3e50; border-left: 5px solid #3498db; padding-left: 15px; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
                        th { background-color: #3498db; color: white; }
                        .highlight { background-color: #f8f9fa; font-weight: bold; }
                        .risk-high { color: #e74c3c; font-weight: bold; }
                        .risk-medium { color: #f39c12; font-weight: bold; }
                        .risk-low { color: #27ae60; font-weight: bold; }
                        @media print { body { margin: 20px; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>üìä REPORTE DE ESTIMACI√ìN COSMIC</h1>
                        <h2>${projectName} v${version}</h2>
                        <p><strong>Cliente:</strong> ${client} | <strong>Fecha:</strong> ${date}</p>
                    </div>
                    
                    <div class="section">
                        <h2>üìã Resumen Ejecutivo</h2>
                        <p><strong>Descripci√≥n:</strong> ${description}</p>
                        <table>
                            <tr><td><strong>Tama√±o Funcional (CFP)</strong></td><td class="highlight">${document.getElementById('totalCFP').textContent}</td></tr>
                            <tr><td><strong>Duraci√≥n Estimada</strong></td><td>${document.getElementById('totalDays').textContent} d√≠as (${document.getElementById('totalMonths').textContent} meses)</td></tr>
                            <tr><td><strong>Costo Total</strong></td><td class="highlight">${document.getElementById('totalCost').textContent}</td></tr>
                        </table>
                    </div>
                    
                    <div class="section">
                        <h2>üéØ Medici√≥n COSMIC Detallada</h2>
                        <table>
                            <thead><tr><th>Tipo de Movimiento</th><th>Cantidad</th><th>CFP</th><th>%</th></tr></thead>
                            <tbody>
                                <tr><td>Entry (Entrada)</td><td>${document.getElementById('totalEntries').value}</td><td>${document.getElementById('entryCFP').textContent}</td><td>${Math.round((parseInt(document.getElementById('entryCFP').textContent) / parseInt(document.getElementById('totalCFP').textContent)) * 100)}%</td></tr>
                                <tr><td>Exit (Salida)</td><td>${document.getElementById('totalExits').value}</td><td>${document.getElementById('exitCFP').textContent}</td><td>${Math.round((parseInt(document.getElementById('exitCFP').textContent) / parseInt(document.getElementById('totalCFP').textContent)) * 100)}%</td></tr>
                                <tr><td>Read (Lectura)</td><td>${document.getElementById('totalReads').value}</td><td>${document.getElementById('readCFP').textContent}</td><td>${Math.round((parseInt(document.getElementById('readCFP').textContent) / parseInt(document.getElementById('totalCFP').textContent)) * 100)}%</td></tr>
                                <tr><td>Write (Escritura)</td><td>${document.getElementById('totalWrites').value}</td><td>${document.getElementById('writeCFP').textContent}</td><td>${Math.round((parseInt(document.getElementById('writeCFP').textContent) / parseInt(document.getElementById('totalCFP').textContent)) * 100)}%</td></tr>
                                <tr class="highlight"><td><strong>TOTAL</strong></td><td>-</td><td><strong>${document.getElementById('totalCFP').textContent}</strong></td><td><strong>100%</strong></td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="section">
                        <h2>üí∞ Desglose de Costos</h2>
                        ${document.getElementById('detailedBreakdown').outerHTML}
                    </div>
                    
                    <div class="section">
                        <h2>‚ö†Ô∏è An√°lisis de Riesgos</h2>
                        ${document.getElementById('riskAnalysis').innerHTML}
                    </div>
                    
                    <div class="section">
                        <h2>üìã Par√°metros de Estimaci√≥n</h2>
                        <table>
                            <tr><td>Productividad</td><td>${document.getElementById('productivity').value} CFP/d√≠a</td></tr>
                            <tr><td>Tarifa por Hora</td><td>${document.getElementById('hourlyRate').value}</td></tr>
                            <tr><td>Horas por D√≠a</td><td>${document.getElementById('hoursPerDay').value}</td></tr>
                            <tr><td>Factor de Complejidad</td><td>${document.getElementById('complexityFactor').value}</td></tr>
                            <tr><td>Factor de Riesgo</td><td>${document.getElementById('riskFactor').value}</td></tr>
                            <tr><td>Overhead</td><td>${document.getElementById('overhead').value}%</td></tr>
                        </table>
                    </div>
                    
                    <div class="section" style="margin-top: 50px; padding-top: 20px; border-top: 2px solid #3498db;">
                        <p><em>Reporte generado autom√°ticamente por Calculadora COSMIC Profesional - ${new Date().toLocaleDateString()}</em></p>
                    </div>
                </body>
                </html>
            `);
            reportWindow.document.close();
        }
        
        // Auto-c√°lculo cuando cambian los valores
        document.addEventListener('DOMContentLoaded', function() {
            // Agregar listeners para inputs num√©ricos
            ['totalReads', 'totalWrites', 'productivity', 'hourlyRate', 'hoursPerDay', 'overhead'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', calculateAll);
                }
            });
            
            // Agregar listeners para selects
            ['complexityFactor', 'riskFactor'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', calculateAll);
                }
            });
            
            // Agregar listeners para procesos funcionales existentes
            document.querySelectorAll('.entry-input, .exit-input').forEach(input => {
                input.addEventListener('input', updateTotals);
            });
            
            // Calcular totales iniciales
            updateTotals();
        });
    </script>
</body>
</html>